<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ThorChain Tax Calculator</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <!-- Begin Icons, thanks to https://realfavicongenerator.net/ -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://www.digitaladapt.com/web3tax/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.digitaladapt.com/web3tax/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://www.digitaladapt.com/web3tax/favicon-16x16.png">
    <link rel="manifest" href="https://www.digitaladapt.com/web3tax/site.webmanifest">
    <link rel="mask-icon" href="https://www.digitaladapt.com/web3tax/safari-pinned-tab.svg" color="#02121d">
    <link rel="shortcut icon" href="https://www.digitaladapt.com/web3tax/favicon.ico">
    <meta name="msapplication-TileColor" content="#02121d">
    <meta name="msapplication-config" content="https://www.digitaladapt.com/web3tax/browserconfig.xml">
    <meta name="theme-color" content="#02121d">
    <!-- End Icons -->
</head>
<body style="background-color: #eff5fb;">
    <section class="section">
        <div class="container">
            <div class="columns is-desktop">
                <div class="column">
                    <div class="box content">
                        <h1 class="title">
                            ThorChain Tax Calculator
                        </h1>
                        <p class="subtitle">
                            Generate import-ready CSV file of your blockchain transactions, just by entering your wallet addresses.
                        </p>
                        <form class="taxForm">
                            <div class="field"><div class="control">
                                <label class="label">THOR <input type="text" name="thor" class="input" placeholder="thor1..." autocomplete="on"></label>
                            </div></div><div class="field"><div class="control">
                                <label class="label">BNB  <input type="text" name="bnb"  class="input" placeholder="bnb1..." autocomplete="on"></label>
                            </div></div><div class="field"><div class="control">
                                <label class="label">BTC  <input type="text" name="btc"  class="input" placeholder="bc1..." autocomplete="on"></label>
                            </div></div><div class="field"><div class="control">
                                <label class="label">LTC  <input type="text" name="ltc"  class="input" placeholder="ltc1..." autocomplete="on"></label>
                            </div></div><div class="field"><div class="control">
                                <label class="label">BCH  <input type="text" name="bch"  class="input" placeholder="q|p..." autocomplete="on"></label>
                            </div></div><div class="field"><div class="control">
                                <label class="label">ETH  <input type="text" name="eth"  class="input" placeholder="0x..." autocomplete="on"></label>
                            </div></div><div class="field"><div class="control">
                                <label class="label">DOGE <input type="text" name="doge" class="input" placeholder="D..." autocomplete="on"></label>
                            </div></div><div class="field">
                                <div class="control">
                                    <label class="checkbox"><input type="checkbox" name="opt-separate"> Non-native RUNE as separate asset <span class="tag is-danger">causes import bugs on Koinly / CoinTracker</span></label>
                                </div>
                                <p class="help">If checked, upgrading your RUNE will be reported as a trade.</p>
                            </div><div class="field is-grouped is-grouped-multiline">
                                <div class="control">
                                    <button type="submit" class="button is-info taxGo">Generate Report</button>
                                </div><div class="control">
                                    <span class="button is-static is-info is-inverted taxStatus" style="border: none;">Status: awaiting user input.</span>
                                </div>
                            </div>
                        </form>
                        <div class="taxResults is-hidden notification is-primary is-light" style="margin-top: 1em;">
                            <form class="taxDownload" method="get" action="/report">
                                <input type="hidden" name="key" class="taxKey">
                                <div class="field"><div class="control">
                                    <label class="label" for="formatID">CSV Format</label>
                                    <div class="taxFormat select is-success"><select name="format" id="formatID">
                                        <option value="cointracker">CoinTracker</option>
                                        <option value="cointracking" class="showGroup">CoinTracking</option>
                                        <option value="koinly">Koinly</option>
                                    </select></div>
                                </div></div><div class="taxGroup field is-hidden"><div class="control">
                                    <label class="label">TradeGroup (optional) <input type="text" name="group" class="input" autocomplete="on"></label>
                                </div></div><div class="field buttons is-grouped">
                                <div class="control is-expanded">
                                    <button type="submit" class="button is-success taxGet">Download CSV</button>
                                </div><div class="control">
                                    <button type="button" class="button is-warning taxBookmark">Make Bookmarkable</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="box content">
                        <h2>Donate</h2>
                        <p>I made this, because I use ThorChain, and needed a way to load hundreds of transactions into my tax software, without having to manually adding each one.</p>
                        <p>I thought others would likely benefit from it as well. If it helps save you time/money, please consider at least a small donation to help keep this project going.</p>
                        <div class="level">
                            <div class="level-item has-text-centered">
                                <figure>
                                  <figcaption>THOR</figcaption>
                                  <img src="https://www.digitaladapt.com/thor.png" alt="thor1vkevvt4u0t7yra4xfk79hy7er38462w8yszx8y">
                                </figure>
                            </div><div class="level-item has-text-centered">
                                <figure>
                                  <figcaption>BNB</figcaption>
                                  <img src="https://www.digitaladapt.com/bnb.png" alt="bnb1v54rp3w9h2hlresmvl0msf4vycnvnuc7nyp6cr">
                                </figure>
                            </div>
                        </div>
                        <ul>
                            <li><strong>thor1vkevvt4u0t7yra4xf<wbr>k79hy7er38462w8yszx8y</strong></li>
                            <li><strong>bnb1v54rp3w9h2hlresmvl<wbr>0msf4vycnvnuc7nyp6cr</strong></li>
                            <li><strong>bc1ql7a704xh4ptzcvm8lx<wbr>6r8hwxcmau09dul6yh7y</strong></li>
                            <li><strong>ltc1qzw06k68yesj62ja0z<wbr>9p4s527et496tdtstxvs5</strong></li>
                            <li><strong>qzcxt5hl30yk3w052n3x6w<wbr>jvky9rwn0p6guz95qmje</strong> (BCH)</li>
                            <li><strong>0x165d707704716b02c050<wbr>935F8Ce6E0429C9829e6</strong> (AVAX,&nbsp;BSC,&nbsp;ETH,&nbsp;FTM,&nbsp;etc.)</li>
                            <li><strong>terra1t8magaxn4q6jllgx<wbr>4hregjh4gtn2k96caqmd7p</strong></li>
                            <li><strong>cosmos1wkzpd9uxftghywe<wbr>h0dd4v58x727ugvqkp0khn5</strong></li>
                        </ul>
                    </div>
                    <div class="box content">
                        <h2>Give Feedback</h2>
                        <p>If you have any thoughts, questions, or would like to report a bug, you can either get hold of <a href="https://twitter.com/digitaladapt" target="_blank">me on Twitter</a>,
                            or you can also use <a href="https://docs.google.com/forms/d/e/1FAIpQLScIeyYEYAHw1fNXakh34ZBpfRv4mZHL0Hu2aCMNMj6PRwTDHQ/viewform" target="_blank">this Google Form</a>.</p> 
                    </div>
                </div>
            </div>
            <div class="columns is-desktop">
                <div class="column">
                    <div class="box content">
                        <h3>Legal</h3>
                        <p>While every attempt has been made to ensure the calculations are correct, use the data at your own risk.</p>
                        <p>This is provided for informational purposes only. It does not constitute financial, tax, or legal advice.</p>
                        <p>No warranty, and we will not be liable for any loss or damage of any nature.</p>
                    </div>
                </div><div class="column">
                    <div class="box content">
                        <h3>Privacy</h3>
                        <p>Wallet addresses, and the generated report are only cached for 2 hours, and never saved to any hard drive.</p>
                        <p>No Google Analytics or anything like that, but I do keep a log of how often the generate report API is called.</p>
                    </div>
                </div><div class="column">
                    <div class="box content">
                        <h3>About Me</h3>
                        <p>Made by <a href="https://www.digitaladapt.com/" target="_blank">DigtialAdapt</a>, find <a href="https://twitter.com/digitaladapt" target="_blank">me on Twitter</a>.</p>
                        <p>&copy; 2022 DigitalAdapt, all rights reserved.</p>
                        <p>Interface built with <a href="https://zeptojs.com/" target="_blank">Zepto.js</a> and <a href="https://bulma.io/" target="_blank">Bulma</a>.</p>
                        <p>Backend powered with <a href="https://nodejs.org/" target="_blank">Node.js</a> and <a href="https://redis.io/" target="_blank">Redis</a>.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div class="modal alertBookmark">
        <div class="modal-background closeBookmark"></div>
        <div class="modal-card">
            <div class="modal-card-body">
                Your address bar now has your wallet addresses, bookmark it, and when you return,
                the fields will automatically re-populate with these addresses.
            </div>
        </div>
        <button class="modal-close closeBookmark is-large" aria-label="close"></button>
    </div>
    <script src="https://zeptojs.com/zepto.min.js"></script>
    <script>
        Zepto(($) => {
            let key = null;

            for (const [key, value] of (new URLSearchParams(window.location.search)).entries()) {
                $('.taxForm').find('[name=' + key + ']').val(value);
            }

            $('.taxBookmark').on('click', () => {
                window.history.pushState({}, '', '/?' + $('.taxForm').serialize());
                $('.alertBookmark').addClass('is-active');
            });

            $('.closeBookmark').on('click', () => {
                $('.alertBookmark').removeClass('is-active');
            });

            $(document).on('keydown', (event) => {
                if (event.keyCode === 27) {
                    $('.alertBookmark').removeClass('is-active');
                }
            });

            // trade-group field appears or hides depending on what format is selected
            const manageGroup = (event) => {
                if ($(event.target.selectedOptions[0]).hasClass('showGroup')) {
                    $('.taxGroup').removeClass('is-hidden');
                } else {
                    $('.taxGroup').addClass('is-hidden');
                }
            };
            manageGroup({ target: document.getElementById('formatID') });
            $('.taxFormat').on('change', manageGroup);

            // handle submit addresses request
            $('.taxGo').on('click', () => {
                const updateStatus = () => {
                    $.getJSON('//' + window.location.host + '/status?key=' + key, (theStatus) => {
                        // update the status message
                        $('.taxStatus').text(theStatus.message);
                        if (theStatus.ready) {
                            if (theStatus.ready >= 1) {
                                // system ready, show the download form
                                $('.taxResults').removeClass('is-hidden');
                            }
                            $('.taxGo').removeClass('is-loading');
                        } else {
                            // wait half a second, and then check the status again
                            setTimeout(updateStatus, 500);
                        }
                    });
                };

                $('.taxGo').addClass('is-loading');
                $('.taxStatus').text('Submitting Request...');
                $.getJSON('//' + window.location.host + '/generate?' + $('.taxForm').serialize(), (response) => {
                    // update the status message
                    $('.taxStatus').text(response.message);
                    if (response.status === 'success') {
                        // set the key
                        key = response.key;
                        $('.taxKey').val(key);

                        // handle the status
                        updateStatus();
                    } else {
                        $('.taxGo').removeClass('is-loading');
                    }
                });
                // do not allow this event to propagate
                return false;
            });
        });
    </script>
</body>
</html>
